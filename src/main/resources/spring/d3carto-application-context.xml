<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:elasticsearch="http://www.springframework.org/schema/data/elasticsearch"
       xsi:schemaLocation="http://www.springframework.org/schema/data/elasticsearch http://www.springframework.org/schema/data/elasticsearch/spring-elasticsearch-1.0.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd">


	<!-- E L A S T I C S E A R C H    C L I E N T -->
    <elasticsearch:node-client id="client" local="true"/>

    <!--<elasticsearch:transport-client id="client" cluster-name="elasticsearch" cluster-nodes="127.0.0.1:9300"/>-->
    <bean name="elasticsearchTemplate" class="org.springframework.data.elasticsearch.core.ElasticsearchTemplate">
        <constructor-arg name="client" ref="client"/>
    </bean>


    <elasticsearch:repositories base-package="org.springframework.data.elasticsearch.repositories" />

	<!-- S P R I N G    B A T C H    C O N F I G U R A T I O N -->
	<import resource="classpath:/spring/d3carto-job-context.xml" />
    <import resource="classpath:/spring/d3carto-job-database.xml" />

	<!-- T A S K L E T S -->
	<bean id="nodeItemReader" class="com.simon.d3carto.batch.tasklet.NodeItemReader" scope="step" />
	<bean id="nodeItemProcessor" class="com.simon.d3carto.batch.tasklet.NodeItemProcessor" scope="step" />
	<bean id="nodeItemWriter" class="com.simon.d3carto.batch.tasklet.NodeItemWriter" scope="step" />
	
	<!-- J O B -->
    <!-- 
        Job features :
        -> EXTRACT: Retrive environments datas (configuration file)
        -> TRANSFORM: Create a POJO from all configuration file
        -> LOAD: Push data into NoSQL DB (ElasticSearch)   
    -->
    <job id="d3CartoJob" xmlns="http://www.springframework.org/schema/batch">
        <step id="getEnvironmentDatas" >            
        	<tasklet ref="nodeItemReader" />
        	<next on="*" to="transformEnvironmentDatas"/>
        </step>
        <step id="transformEnvironmentDatas">
        	<tasklet ref="nodeItemProcessor" />
        	<next on="*" to="pushEnvironmentDatas"/>
        </step>
        <step id="pushEnvironmentDatas">
        	<tasklet ref="nodeItemWriter" />
        </step>
    </job>

</beans>